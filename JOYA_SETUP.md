# JOYA - Instance Setup

You are an AI agent. Your human asked you to set up JOYA â€” a governance framework for multi-agent teams.

This runs **once per installation**. After completing this, you will become the Manager.

---

## Phase 0: Clone the Repository

If you're reading this from a URL (not a local file), clone the repo first:

```bash
git clone https://github.com/JoyAgents-AI/JOYA.git ~/joya/lib
```

Then set these paths (adjust if your human prefers a different location):
- `JOYA_LIB=~/joya/lib` â€” the framework (this repo)
- `JOYA_MY=~/joya/my` â€” your instance data (created in Phase 3)

If you're already reading this from a local file, detect `JOYA_LIB` from your current path.

---

## Phase 1: Environment Detection

Auto-detect the following. Do NOT ask the user for information you can obtain programmatically.

| Item | How to detect | Fallback |
|------|--------------|----------|
| **Timezone** | System locale, OpenClaw runtime config, or `date +%Z` | Ask user |
| **Language** | Language of user's first message to you | Default: English |
| **Platform/Runtime** | Check for `~/.openclaw/`, `~/.claude/`, `.cursor/`, `.windsurfrules`, `~/.gemini/` | Ask user |
| **OS** | `uname -s` / runtime metadata | Ask user |
| **Communication channels** | Scan runtime config for configured channels (Mattermost, Telegram, etc.) | None initially |
| **Node count** | Count available nodes from runtime | 1 (this machine) |

Present the detection results to the user:

> ğŸ”§ Detected environment:
> - Timezone: Asia/Shanghai
> - Language: ä¸­æ–‡
> - Platform: OpenClaw on macOS (arm64)
> - Channels: Mattermost âœ“, Telegram âœ“
>
> Anything wrong? (Enter to confirm, or correct me)

## Phase 2: Core Preferences (Setup Wizard)

Ask only what cannot be detected or reasonably defaulted. Each question has a recommended default - user can press Enter to accept.

### Q1: Reporting Style

> Agent å®Œæˆä»»åŠ¡åæ€ä¹ˆå‘ä½ æ±‡æŠ¥ï¼Ÿ
>
> a) **ç²¾ç®€** - ä¸€ä¸¤å¥è¯ï¼Œåªè¯´ç»“æœå’Œé—®é¢˜ â† æ¨è
> b) **æ‘˜è¦** - å…³é”®æ•°æ®ç‚¹ + ç»“è®º
> c) **è¯¦ç»†** - å®Œæ•´è¿‡ç¨‹å’Œæ¨ç†
>
> (ç›´æ¥å›è½¦é€‰ aï¼Œæˆ–è¾“å…¥ b/c)

### Q2: Autonomy Level

> Agent çš„è‡ªä¸»æƒèŒƒå›´ï¼Ÿ
>
> a) **é«˜è‡ªä¸»** - æ—¥å¸¸ä»»åŠ¡ç›´æ¥åšï¼Œæ¶æ„å˜æ›´/å¤–éƒ¨æ“ä½œ/ç ´åæ€§æ“ä½œæ‰é—®ä½  â† æ¨è
> b) **å…ˆè¯´ååš** - æ–°ä»»åŠ¡å…ˆè¯´è®¡åˆ’ï¼Œä½ ç¡®è®¤åå†æ‰§è¡Œ
> c) **æ¯æ­¥ç¡®è®¤** - é‡è¦æ“ä½œé€æ­¥ç¡®è®¤
>
> (ç›´æ¥å›è½¦é€‰ aï¼Œæˆ–è¾“å…¥ b/c)

### Q3: Resource Strategy

> æ¨¡å‹å’Œç®—åŠ›çš„ä½¿ç”¨ç­–ç•¥ï¼Ÿ
>
> a) **çœé’±** - é»˜è®¤è½»é‡æ¨¡å‹ï¼Œå¤æ‚ä»»åŠ¡å†å‡çº§
> b) **å¹³è¡¡** - æŒ‰ä»»åŠ¡å¤æ‚åº¦è‡ªåŠ¨åˆ†çº§ â† æ¨è
> c) **è´¨é‡** - é»˜è®¤æœ€å¼ºæ¨¡å‹
>
> (ç›´æ¥å›è½¦é€‰ bï¼Œæˆ–è¾“å…¥ a/c)

**é‡è¦**ï¼šå¦‚æœç”¨æˆ·è¯´"è·³è¿‡"æˆ–"ä»¥åå†è¯´"ï¼Œå…¨éƒ¨ä½¿ç”¨æ¨èé»˜è®¤å€¼ï¼Œå¹¶å‘ŠçŸ¥å¯éšæ—¶è¯´"è°ƒæ•´é…ç½®"æ¥ä¿®æ”¹ã€‚

## Phase 3: Generate Instance Files

Based on detection + wizard answers, generate the `$JOYA_MY/` structure.

### 3.1 Copy starter template

```bash
cp -r toolkit/starter/ $JOYA_MY/
```

If `$JOYA_MY/` already has content, merge carefully - don't overwrite.

### 3.2 Write PREFERENCES.md

Generate `$JOYA_MY/shared/core/PREFERENCES.md` from wizard answers:

```markdown
# Instance Preferences
# Generated by JOYA Setup Wizard â€” editable anytime
# New sections can be added at any time (by Manager, framework upgrades, or manually).

## Reporting
style: concise          # concise | summary | detailed
notify_on: milestone, blocked, decision
language: auto          # auto = detected from conversation

## Autonomy
level: high             # high | plan-first | confirm-each
always_confirm:
  - architecture_change
  - external_communication  
  - destructive_operation
  - permission_change

## Resources
strategy: balanced      # frugal | balanced | quality

## Translation
model: low-cost          # low-cost | default | <specific model name>
# Agent should switch to a cheap model (e.g. GPT-4o-mini, Gemini Flash, Haiku)
# when translating framework docs to save tokens.

## Maintenance
heartbeat: 7d           # heartbeat check interval
gc_frequency: weekly    # weekly | biweekly | manual
audit_frequency: monthly # monthly | quarterly | manual

## Setup
completed: <date>
version: 1

# ---- Dynamic preferences below this line ----
# Manager adds new sections here when recurring patterns are observed.
# Format: ## <Category>\n key: value  # description
# Example:
#   ## Code Review
#   auto_approve_typo_fixes: true  # skip confirmation for typo-only PRs
```

### 3.3 Write PRINCIPAL.md

Generate from detected + user-provided info:

```markdown
# Principal

- **Name:** <from conversation>
- **Timezone:** <detected>
- **Language:** <detected>

## Communication Preferences
<derived from Q1 - reporting style>

## Decision Authority
<derived from Q2 - autonomy level>
```

### 3.4 Write PLAYBOOK.md skeleton

Generate with detected channel info and sensible defaults. Include the `---` divider between Essential and Extended sections.

### 3.5 Write INFRASTRUCTURE.md

Index file pointing to empty `infra/` subdirectory. Populated as infrastructure is added.

## Phase 4: Self-Setup as First Agent

You are now the first agent. Run `AGENT_SETUP.md` Â§ First-Time Onboarding to:

1. Create your agent directory (`$JOYA_MY/agents/<your-name>/`)
2. Write your IDENTITY.md (ask user for name + persona, or use defaults)
3. Set role = Manager in ROSTER.md
4. Connect runtime adapter
5. Read the protocol (full loading)

> **Note**: The Onboarding Exam is waived for the first agent - the Principal grants a Manager exemption. Write: `Exam: PASS (Principal exemption) think:<default> v<version>`

## Phase 5: Confirm

Present a summary:

> âœ… JOYA åˆå§‹åŒ–å®Œæˆ
>
> - ğŸ“‹ åå¥½: ç²¾ç®€æ±‡æŠ¥ / é«˜è‡ªä¸» / å¹³è¡¡èµ„æº
> - ğŸ¤– Manager: Cla (ä½ )
> - ğŸ“¡ é€šä¿¡: Mattermost, Telegram
> - â° ç»´æŠ¤: æ¯å‘¨å¿ƒè·³, æ¯å‘¨ GC, æ¯æœˆå®¡è®¡
>
> ä½ å¯ä»¥éšæ—¶è¯´"è°ƒæ•´é…ç½®"æ¥ä¿®æ”¹åå¥½ã€‚
> æ¥ä¸‹æ¥å¯ä»¥ï¼šæ·»åŠ  Agent / å¼€å§‹é¡¹ç›® / æ¢ç´¢æ¡†æ¶

Write completion marker to PREFERENCES.md (`completed: <date>`).

---

## Reconfiguration

No special command needed. The Manager should recognize when the Principal expresses a preference change in natural conversation - for example:

- "åˆ«æŠ¥é‚£ä¹ˆè¯¦ç»†äº†" â†’ update `style` to `concise`
- "ä»¥åå°äº‹åˆ«é—®æˆ‘äº†" â†’ update `level` to `high`
- "æœ€è¿‘çœç€ç‚¹ç”¨" â†’ update `strategy` to `frugal`

On detecting such intent: read `PREFERENCES.md`, update the relevant field, confirm the change to the Principal in one sentence.

If the Principal explicitly asks to review all settings (e.g. "çœ‹çœ‹ç°åœ¨çš„é…ç½®"), present the full PREFERENCES.md in a readable format and offer to change any item.

### When to proactively suggest config changes

The Manager should suggest preference adjustments when patterns indicate a mismatch:

| Signal | Suggestion |
|--------|-----------|
| Principal repeatedly asks for more/less detail | "æˆ‘æ³¨æ„åˆ°ä½ ç»å¸¸è¦æ±‚æ›´ç®€æ´çš„æ±‡æŠ¥ï¼Œè¦ä¸è¦æˆ‘è°ƒä¸€ä¸‹é»˜è®¤æ±‡æŠ¥é£æ ¼ï¼Ÿ" |
| Principal keeps overriding an autonomous action | "è¿™ç±»æ“ä½œä½ è¿ç»­ä¸‰æ¬¡è¦æ±‚å…ˆç¡®è®¤ï¼Œè¦åŠ åˆ°éœ€ç¡®è®¤åˆ—è¡¨å—ï¼Ÿ" |
| Principal keeps approving without looking | "è¿™ç±»æ“ä½œä½ æ¯æ¬¡éƒ½ç›´æ¥æ‰¹å‡†ï¼Œè¦æ”¹æˆè‡ªä¸»æ‰§è¡Œå—ï¼Ÿ" |
| Resource usage pattern shifts | "æœ€è¿‘ä»»åŠ¡åç®€å•ï¼Œè¦åˆ‡åˆ°çœé’±æ¨¡å¼å—ï¼Ÿ" |
| New framework feature introduces a config option | å‡çº§åä¸»åŠ¨ä»‹ç»æ–°é€‰é¡¹ |
| First week after setup | "ç”¨äº†ä¸€å‘¨äº†ï¼Œå½“åˆçš„é…ç½®è¿˜åˆé€‚å—ï¼Ÿè¦è°ƒæ•´ä»€ä¹ˆï¼Ÿ" |

**åŸåˆ™**ï¼šä¸è¦é¢‘ç¹æ‰“æ‰°ã€‚åŒä¸€ç±»å»ºè®®æœ€å¤šæä¸€æ¬¡ï¼Œç”¨æˆ·æ‹’ç»åè®°å½•ï¼Œä¸å†é‡å¤ã€‚
