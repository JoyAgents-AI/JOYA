# JOYA - Instance Setup

You are an AI agent. Your human asked you to set up JOYA â€” a governance framework for multi-agent teams.

This runs **once per installation**. After completing this, you will become the Manager.

---

## Phase 0: Clone the Repository

If you're reading this from a URL (not a local file), clone the repo first:

```bash
git clone https://github.com/JoyAgents-AI/JOYA.git ~/joya/lib
```

Then set these paths (adjust if your human prefers a different location):
- `JOYA_LIB=~/joya/lib` â€” the framework (this repo)
- `JOYA_MY=~/joya/my` â€” your instance data (created in Phase 3)

If you're already reading this from a local file, detect `JOYA_LIB` from your current path.

---

## Phase 1: Environment Detection

Auto-detect the following. Do NOT ask the user for information you can obtain programmatically.

| Item | How to detect | Fallback |
|------|--------------|----------|
| **Timezone** | System locale, OpenClaw runtime config, or `date +%Z` | Ask user |
| **Language** | Language of user's first message to you | Default: English |
| **Platform/Runtime** | Check for `~/.openclaw/`, `~/.claude/`, `.cursor/`, `.windsurfrules`, `~/.gemini/` | Ask user |
| **OS** | `uname -s` / runtime metadata | Ask user |
| **Communication channels** | Scan runtime config for configured channels (Mattermost, Telegram, etc.) | None initially |
| **Node count** | Count available nodes from runtime | 1 (this machine) |

Present the detection results to the user:

> ðŸ”§ Detected environment:
> - Timezone: Asia/Shanghai
> - Language: Chinese
> - Platform: OpenClaw on macOS (arm64)
> - Channels: Mattermost âœ“, Telegram âœ“
>
> Anything wrong? (Enter to confirm, or correct me)

## Phase 2: Core Preferences (Setup Wizard)

Ask only what cannot be detected or reasonably defaulted. Each question has a recommended default - user can press Enter to accept.

### Q1: Reporting Style

> How should agents report task completion?
>
> a) **Concise** - One or two sentences, results and issues only â† Recommended
> b) **Summary** - Key data points + conclusions
> c) **Detailed** - Full process and reasoning
>
> (Press Enter for a, or type b/c)

### Q2: Autonomy Level

> Agent autonomy level?
>
> a) **High autonomy** - Execute routine tasks directly; only ask for architecture changes, external ops, or destructive actions â† Recommended
> b) **Plan first** - Propose a plan for new tasks; execute after your confirmation
> c) **Step-by-step** - Confirm each significant action
>
> (Press Enter for a, or type b/c)

### Q3: Resource Strategy

> Model and compute usage strategy?
>
> a) **Frugal** - Default to lightweight models; upgrade only for complex tasks
> b) **Balanced** - Auto-tier by task complexity â† Recommended
> c) **Quality** - Default to the strongest model
>
> (Press Enter for b, or type a/c)

**Important**: If the user says "skip" or "later", use all recommended defaults and inform them they can say "adjust config" anytime to change.

## Phase 3: Generate Instance Files

Based on detection + wizard answers, generate the `$JOYA_MY/` structure.

### 3.1 Copy starter template

```bash
cp -r toolkit/starter/ $JOYA_MY/
```

If `$JOYA_MY/` already has content, merge carefully - don't overwrite.

### 3.2 Write PREFERENCES.md

Generate `$JOYA_MY/shared/core/PREFERENCES.md` from wizard answers:

```markdown
# Instance Preferences
# Generated by JOYA Setup Wizard â€” editable anytime
# New sections can be added at any time (by Manager, framework upgrades, or manually).

## Reporting
style: concise          # concise | summary | detailed
notify_on: milestone, blocked, decision
language: auto          # auto = detected from conversation

## Autonomy
level: high             # high | plan-first | confirm-each
always_confirm:
  - architecture_change
  - external_communication  
  - destructive_operation
  - permission_change

## Resources
strategy: balanced      # frugal | balanced | quality

## Translation
model: low-cost          # low-cost | default | <specific model name>
# Agent should switch to a cheap model (e.g. GPT-4o-mini, Gemini Flash, Haiku)
# when translating framework docs to save tokens.

## Maintenance
heartbeat: 7d           # heartbeat check interval
gc_frequency: weekly    # weekly | biweekly | manual
audit_frequency: monthly # monthly | quarterly | manual

## Setup
completed: <date>
version: 1

# ---- Dynamic preferences below this line ----
# Manager adds new sections here when recurring patterns are observed.
# Format: ## <Category>\n key: value  # description
# Example:
#   ## Code Review
#   auto_approve_typo_fixes: true  # skip confirmation for typo-only PRs
```

### 3.3 Write PRINCIPAL.md

Generate from detected + user-provided info:

```markdown
# Principal

- **Name:** <from conversation>
- **Timezone:** <detected>
- **Language:** <detected>

## Communication Preferences
<derived from Q1 - reporting style>

## Decision Authority
<derived from Q2 - autonomy level>
```

### 3.4 Write PLAYBOOK.md skeleton

Generate with detected channel info and sensible defaults. Include the `---` divider between Essential and Extended sections.

### 3.5 Write INFRASTRUCTURE.md

Index file pointing to empty `infra/` subdirectory. Populated as infrastructure is added.

## Phase 4: Self-Setup as First Agent

You are now the first agent. Run `AGENT_SETUP.md` Â§ First-Time Onboarding to:

1. Create your agent directory (`$JOYA_MY/agents/<your-name>/`)
2. Write your IDENTITY.md (ask user for name + persona, or use defaults)
3. Set role = Manager in ROSTER.md
4. Connect runtime adapter
5. Read the protocol (full loading)

> **Note**: The Onboarding Exam is waived for the first agent - the Principal grants a Manager exemption. Write: `Exam: PASS (Principal exemption) think:<default> v<version>`

## Phase 5: Confirm

Present a summary:

> âœ… JOYA setup complete
>
> - ðŸ“‹ Preferences: Concise reporting / High autonomy / Balanced resources
> - ðŸ¤– Manager: Cla (you)
> - ðŸ“¡ Comms: Mattermost, Telegram
> - â° Maintenance: Weekly heartbeat, weekly GC, monthly audit
>
> You can say "adjust config" anytime to change preferences.
> Next steps: Add an Agent / Start a project / Explore the framework

Write completion marker to PREFERENCES.md (`completed: <date>`).

---

## Reconfiguration

No special command needed. The Manager should recognize when the Principal expresses a preference change in natural conversation - for example:

- "Don't be so verbose" â†’ update `style` to `concise`
- "Stop asking me about small stuff" â†’ update `level` to `high`
- "Let's save some budget" â†’ update `strategy` to `frugal`

On detecting such intent: read `PREFERENCES.md`, update the relevant field, confirm the change to the Principal in one sentence.

If the Principal explicitly asks to review all settings (e.g. "show me current config"), present the full PREFERENCES.md in a readable format and offer to change any item.

### When to proactively suggest config changes

The Manager should suggest preference adjustments when patterns indicate a mismatch:

| Signal | Suggestion |
|--------|-----------|
| Principal repeatedly asks for more/less detail | "I noticed you often ask for shorter reports. Want me to change the default reporting style?" |
| Principal keeps overriding an autonomous action | "You've asked to confirm this type of action three times in a row. Add it to the confirmation list?" |
| Principal keeps approving without looking | "You always approve this type of action immediately. Switch to autonomous execution?" |
| Resource usage pattern shifts | "Recent tasks have been simple. Switch to frugal mode?" |
| New framework feature introduces a config option | After upgrade, proactively introduce new options |
| First week after setup | "It's been a week. Are the initial settings still working for you? Anything to adjust?" |

**Principle**: Do not pester. Each suggestion type may be offered at most once. If declined, record it and do not repeat.
